---
tags:
  - Initial Access
  - Exploit Public-Facing Application
  - High
  - T1190
---
## Security Group\FW with Ingress rule allowing access from any IP address

=== "AWS"
    ``` yaml linenums="1"
    title: Creation of AWS Security group ingress rule allowing access from any IP address
    id: 53bea7a4-d25e-444c-b385-3fad4b21d5f5
    status: test
    description: Detects the creation or modification of security group with a public exposure.
    author: asafaprozper
    date: 2022/10/31
    tags:
        - attack.initial_access
        - attack.t1190
    logsource:
        product: aws
        service: cloudtrail
    detection:
        selection_source:
            eventSource: ec2.amazonaws.com
            eventName: 
                - AuthorizeSecurityGroupIngress
                - ModifySecurityGroupRules
        keywords:
            - '0.0.0.0/0'
        filter:
            sourceIPAddress: eks.amazonaws.com
        condition: selection_source and keywords and not filter
    falsepositives:
        - The security group created with 0.0.0.0, but the cloud resource is without external IP address or protected with WAF rules for specific IP ranges.
    level: high
    ```
=== "GCP"
    ``` yaml linenums="1"
    title: FW rule allowing access from any IP address over GCP
    id: a81899a4-b0f3-4f5f-a0f4-62f76962321a
    status: test
    description: Detects the creation or update of FW rule with a public exposure.
    author: asafaprozper
    date: 2022/11/01
    tags:
        - attack.initial_access
        - attack.t1190
    logsource:
        product: gcp
        service: compute.googleapis.com
    detection:
        selection_source:
            data.resource.type: gce_firewall_rule
            data.protoPayload.methodName: 
                - v1.compute.firewalls.insert
                - v1.compute.firewalls.update
                - v1.compute.firewalls.patch
            data.protoPayload.request.alloweds:
                - "*"
        keywords:
            - '0.0.0.0/0'
        condition: selection_source and keywords
    falsepositives:
        - The security group created with 0.0.0.0, but the cloud resource is without external IP address or protected with WAF rules for specific IP ranges.
    level: high
    ```

## Resource Exposed to All Users or All Auth Users
=== "AWS"
    ``` yaml linenums="1"
    title: Resource Exposed to All Users or All Auth Users
    id: f26a54a1-6e8a-4be3-9adb-2d90acc0d5c8
    status: test
    description: Detects a policy which granting access to all users (public) or all authenticated AWS users.
    author: asafaprozper
    date: 2022/10/31
    tags:
        - attack.initial_access
        - attack.t1190
    logsource:
        product: aws
        service: cloudtrail
    detection:
        selection_source:
            eventName: 
                - FunctionURLAllowPublicAccess
        keywords:
            - 'http://acs.amazonaws.com/groups/global/AllUsers'
            - 'http://acs.amazonaws.com/groups/global/AuthenticatedUsers'
            - '"Principal":"*"'
            - '"Principal":{"AWS":"*"}'
        condition: selection_source or keywords
    falsepositives:
        - Sometimes send sns is publicy exposed to all users by default
    level: high
    ```
=== "GCP"
    ``` yaml linenums="1"
    title: Resource Exposed to All Users or All Auth Users
    id: 249c3646-30aa-45d1-b235-8d2c7f6240ea
    status: test
    description: Detects an IAM policy which granting access to all users (public) or all authenticated Google users.
    author: asafaprozper
    date: 2022/11/01
    tags:
        - attack.initial_access
        - attack.t1190
    logsource:
        product: gcp
        service: "*.googleapis.com"
    detection:
        selection_source:
            data.protoPayload.methodName|contains:
                - "SetIam"
            data.protoPayload.serviceData.policyData.bindingDeltas.member: 
                - "allUsers"
                - "allAuthenticatedUsers"
            data.protoPayload.serviceData.policyData.bindingDeltas.action:
                - "ADD"
        condition: selection_source
    falsepositives:
        - not found any
    level: high
    ```