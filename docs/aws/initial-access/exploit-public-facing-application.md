---
tags:
  - Initial Access
  - Exploit Public-Facing Application
  - High
  - T1190
---
## Ingress rule allowing access from any IP address

=== "AWS"
    ``` yaml linenums="1"
    title: Ingress rule allowing access from any IP address
    id: 53bea7a4-d25e-444c-b385-3fad4b21d5f5
    status: test
    description: Detects the creation or modification of security group with a public exposure.
    author: asafaprozper
    date: 2022/10/31
    tags:
        - attack.initial_access
        - attack.t1190
    logsource:
        product: aws
        service: cloudtrail
    detection:
        selection_source:
            eventSource: ec2.amazonaws.com
            eventName: 
                - AuthorizeSecurityGroupIngress
                - ModifySecurityGroupRules
        keywords:
            - '0.0.0.0/0'
        filter:
            sourceIPAddress: eks.amazonaws.com
        condition: selection_source and keywords and not filter
    falsepositives:
        - The security group created with 0.0.0.0, but the cloud resource is without external IP address\protected with WAF\behind LoadBalance so it not really publicly exposed.
    level: high
    ```
=== "GCP"
    ``` yaml linenums="1"
    ```

## Resource Exposed to All Users or All Auth Users
``` yaml linenums="1"
title: Resource Exposed to All Users or All Auth Users
id: f26a54a1-6e8a-4be3-9adb-2d90acc0d5c8
status: test
description: Detects a policy which granting access to all users (public) or all authenticated AWS users.
author: asafaprozper
date: 2022/10/31
tags:
    - attack.initial_access
    - attack.t1190
logsource:
    product: aws
    service: cloudtrail
detection:
    selection_source:
        eventName: 
            - FunctionURLAllowPublicAccess
    keywords:
        - 'http://acs.amazonaws.com/groups/global/AllUsers'
        - 'http://acs.amazonaws.com/groups/global/AuthenticatedUsers'
        - '"Principal":"*"'
        - '"Principal":{"AWS":"*"}'
    condition: selection_source or keywords
falsepositives:
    - Sometimes send sns is publicy exposed to all users by default
level: high
```    
## Creation of application endpoint
## Creation of LB public